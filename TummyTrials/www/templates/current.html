<!-- 
Page Hierarchy:

- Calendar widget   when ongoing/scheduled study && if experiment has started && last day of study has passed 
- Day card          when ongoing/scheduled study
  - Scheduled but not started 
  - Started but not past
    - Reminder card
    - Optional card
  - Past but not ended
  - Abandon card
- No onging study  
-->


<ion-view title="{{title}}" cache-view="false">
  <ion-pane>
    <ion-content>
    <div class="calendar" ng-show="(study_current && !exp_bool && !is_past)">
      <br/><!-- <h4 class="padding"> {{title_text}} Study</h4> -->
      <h5 class="padding">Day {{day_num}} of {{duration_readable}}</h5>
      <div class="divcenter">
      <div class="button-bar"> 
        <div ng-repeat="day in schedule">
          <a class="button" ng-if="day[0] != today_readable" ng-show="$index < row_length"  ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
          <a class="button button-energized" ng-if="day[0] == today_readable" ng-show="$index < row_length" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
        </div>
      </div>

      <div class="button-bar">
        <div ng-repeat="day in schedule">
          <a class="button" ng-if="day[0] != today_readable" ng-show="$index >= row_length" ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
          <a class="button button-energized" ng-if="day[0] == today_readable" ng-show="$index >= row_length" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
        </div>
      </div>
      </div>
      <br/>
      <!-- Legend for the calendar -->
      <div class="padding">
        <i class="ion-stop positive" style="font-size: 150%;"></i> Condition: {{A_text}} <br/>
        <i class="ion-stop balanced" style="font-size: 150%;"></i> Contidion: {{B_text}} <br/>
        <i class="ion-stop energized" style="font-size: 150%;"></i> Current day <br/>
      </div>
      <br/>
    </div>

    <div class="padding" ng-hide="!study_current">    
        <!-- 
        Content to display when there is no on going trial
        --> 
        <div class="card padding" ng-hide="!exp_bool">
          <h4 class="title">{{text.current.title}} {{today_full}}</h4>
          You have an trial scheduled to begin on {{start_date_full}}. <br/><br/>
          To view trial details or abandon trial go to the current trial under 'My Trials' tab. <br/>
        </div>    

        <!-- 
        Content to display when trial underway
        --> 
        <div ng-show="(!exp_bool && !is_past)">
        
          <!-- Card to display during accelerated trial -->
          <div class="card padding" ng-show="accelerated">
            <h4 class="assertive item-text-wrap">Accelerated Trial enabled!</h4>
              <b>The entire trial will be completed in one hour. </b><br/>
              Please note that certain features like date, breakfast preferences, and calendar widget will not be available during accelerated trial.
              You will be able to enter your daily compliance and symptom severity levels as expected.
            </p>
          </div>

          <div class="card padding" ng-hide="accelerated">
            <h4 class="title">{{text.current.title}} {{today_full}}</h4>
            <p>{{text.current.subtitle}} <b>{{active_text}}</b> {{text.current.subtitle2}}</p>
            <p><a style="text-decoration: underline; color:royal" ng-click="help = help ? false : true">{{text.current.para1}}</a></p> 
            <div class="card" ng-show="help">
               <div class="item item-text-wrap list_text">
                   <b>For breakfast:</b><br/>
                   <span class="new_line">{{active_bfst}}</span><br/><br/>
                   <b>For drink:</b><br/>
                   <span class="new_line">{{active_drnk}}</span>
               </div>
            </div>
          </div>

          <div class="card padding" ng-hide="sbmtd">   
            <h4>{{text.current.reminder_title}}</h4>
            <!-- <p ng-show="!study_current">(No current trial. Please create a new trial.)</p> -->
                <div ng-repeat="rem in study_reminders">
                    <p>
                    <i class="ion-ios-checkmark" ng-hide="rem.reportdue" style="font-size: 120%;"></i>
                    <i class="ion-ios-circle-outline" ng-show="rem.reportdue" style="font-size: 120%;"></i>
                    {{rem.schedmsg}} <br/>
                    <em class="balanced" ng-bind-html="rem.reportmsg"></em>
                    <div class="divcenter" ng-show="!!rem.logmsg">
                        <a class="button button-small button-royal small-text" ui-sref="{{rem.logstate}}" ng-disabled="sbmtd || rem.disabled">
                            &nbsp&nbsp {{rem.logmsg}} &nbsp&nbsp
                        </a>
                    </div>
                    </p>
                    <!-- <br/> -->
                </div>
                <div class="card padding divcenter submit-card">
                  <p ng-show="sym_scr_st">{{text.current.submit_text}}</p>
                  <!-- <p ng-show="sbmtd">{{text.current.submitted_text}}</p> -->
                  <p ng-show="!sym_scr_st">{{text.current.submit_cant}}</p>
                  <a class="button button-royal" ng-click="submit_for_day()" ng-disabled="sbmtd || !sym_scr_st" > &nbsp&nbsp {{text.current.submit_button}} &nbsp&nbsp </a>
                </div>
          </div>

          <!-- Card to show when the user submits the report for the day -->
          <div class="card padding" ng-show="sbmtd">
            <h4>{{text.current.report_sum_title}}</h4>
            <div ng-repeat="rem in study_reminders">
              <em class="balanced" ng-bind-html="rem.reportmsg"></em>
            </div><br/>
            <p>{{text.current.submitted_text}}</p>
          </div>

          <div class="card padding">
            <h4>Note:</h4>
              <p>
                <span ng-hide="nt_fg">{{text.current.note}}</span>
                <span ng-show="nt_fg">{{text.current.note2}}</span> <br/><br/>
                <span ng-show="nt_fg" class="balanced">{{note}}</span>
                <div class="divcenter">
                  <a class="button button-royal" ui-sref="notes">
                    {{nt_btn_txt}}
                  </a>
                </div>
              </p>
          </div> 
        </div>
        <!-- 
        Content to display when trial is underway but past the last day.
        -->         
        <div ng-show="is_past">
            Your <em>{{title}}</em> is past. Please <b>end</b> the trial to see the results.
        </div>

    </div>

    <!-- 
    Content to display when there is no on going study
    --> 
    <div class="card padding" ng-show="!study_current">
        <h4 class="title">No ongoing trial</h4>
        <br/>
        <p>Would you like to setup a new trial?</p>
        <br/>
        <a class="button button-block button-royal" ui-sref="setup_1">
          Setup a New Trial
        </a>
    </div>   

     <div class="card padding">
        For testing purposes only: <br/>
        {{exp_id}}
     </div>

    </ion-content>  
  </ion-pane>
</ion-view>
