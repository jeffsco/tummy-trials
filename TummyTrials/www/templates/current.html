<!-- 
Page Hierarchy:

- Calendar widget   when ongoing/scheduled study && if experiment has started && last day of study has passed 
- Day card          when ongoing/scheduled study
  - Scheduled but not started 
  - Started but not past
    - Reminder card
    - Optional card
  - Past but not ended
  - Abandon card
- No onging study  
-->


<ion-view title="{{title}}" cache-view="false">
  <ion-pane>
    <ion-content>
    <div class="calendar" ng-show="(study_current && !exp_bool && !is_past)">
      <br/>
      <div class="row"> 
        <div class="col">
          <h5>Day {{day_num}} of {{duration_readable}}</h5>
        </div>
        <!-- Legend for the calendar -->
        <div class="col col-75">
          <i class="ion-stop positive twelve" style="font-size: 100%;"></i> {{A_text}} <br/>
          <i class="ion-stop balanced twelve" style="font-size: 100%;"></i> {{B_text}} <br/>
          <!-- <i class="ion-stop energized" style="font-size: 150%;"></i> Current day <br/> -->
        </div>
      </div>
      <div class="divcenter">
        <div class="button-bar"> 
          <div ng-repeat="day in schedule">
            <a class="button" ng-if="day[0] != today_readable" ng-show="$index < row_length"  ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
            <a class="button" ng-if="day[0] == today_readable" ng-show="$index < row_length" ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">
              <span class="not-on-top"> <i class="ion-android-radio-button-off energized" style="font-size: 250%;"></i> </span>
              <span class="on-top">{{day[0]}}</span>
            </a>
          </div>
        </div>

        <div class="button-bar">
          <div ng-repeat="day in schedule">
            <a class="button" ng-if="day[0] != today_readable" ng-show="$index >= row_length" ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">{{day[0]}}</a>
            <a class="button" ng-if="day[0] == today_readable" ng-show="$index >= row_length" ng-class="day[1] == 'A' ? 'button-positive' : 'button-balanced'" ng-click="calendardata.button = day[0]" ui-sref="calendar">
              <span class="not-on-top"> <i class="ion-android-radio-button-off energized" style="font-size: 250%;"></i> </span>
              <span class="on-top">{{day[0]}}</span>
            </a>
          </div>
        </div>
      </div>
      <br/>

      <br/>
    </div>

    <div class="padding" ng-hide="!study_current">    
        <!-- 
        Content to display when there is no on going trial
        --> 
        <div class="card padding" ng-hide="!exp_bool">
          <h4 class="title">{{text.current.title}} {{today_full}}</h4>
          You have an trial scheduled to begin on {{start_date_full}}. <br/><br/>
          To view trial details or abandon trial go to the current trial under 'My Trials' tab. <br/>
        </div>    

        <!-- 
        Content to display when trial underway
        --> 
        <div ng-show="(!exp_bool && !is_past)">
        
          <!-- Card to display during accelerated trial -->
          <div class="card padding" ng-show="accelerated">
            <h4 class="assertive item-text-wrap">Accelerated Trial enabled!</h4>
              <b>The entire trial will be completed in one hour. </b><br/>
              Please note that certain features like date, breakfast preferences, and calendar widget will not be available during accelerated trial.
              You will be able to enter your daily compliance and symptom severity levels as expected.
            </p>
          </div>


          <!-- Change content of card based on state of report
          Initially, show condition for day and food pref help
          Once bfst compliance entered, show 'do not eat message'
          Once symptom reported, show 'submit for day' 
          Once report submitted, show 'done for the day' -->
          <!-- Condition 1 of 4: initial -->
          <div class="card padding" ng-hide="bfst_comp_state" >
            <h4 class="title">{{text.current.title}} {{today_full}}</h4>
            <p>{{text.current.subtitle}} <br/>
                <b>{{active_text}}</b></p>
            <p><a style="text-decoration: underline; color:royal" ng-click="help = help ? false : true">{{text.current.para1}}</a></p> 
            <div class="card" ng-show="help">
               <div class="item item-text-wrap list_text">
                   <b>To eat:</b><br/>
                   <span class="new_line">{{active_bfst}}</span><br/><br/>
                   <b>To drink:</b><br/>
                   <span class="new_line">{{active_drnk}}</span>
               </div>
            </div>
          </div>
          <!-- Condition 2 of 4: bfst complied -->
          <div class="card padding" ng-hide="!bfst_comp_state || sym_score_state">
            <h4 class="title">Breakfast complied</h4>
            <p>Between {{bfst_rem}} and {{sym_rem}}:<br/>
                <b>Do not eat or drink.</b></p>
            <p><a style="text-decoration: underline; color:royal" ng-click="help = help ? false : true">{{text.current.para1}}</a></p> 
            <div class="card" ng-show="help">
               <div class="item item-text-wrap list_text">
                   <b>To eat:</b><br/>
                   <span class="new_line">Nothing</span><br/><br/>
                   <b>To drink:</b><br/>
                   <span class="new_line">Okay to drink water</span>
               </div>
            </div>
          </div>
          <!-- Condition 3 of 4: symptom reported -->
          <div class="card padding" ng-hide="!sym_score_state || sym_submit">
            <h4 class="title">Symptom reported</h4>
            <p> Submit your report for the day by clicking on the confirm button below the reminders.</p>
          </div>
          <!-- Condition 4 of 4: done4day -->
          <div class="card padding" ng-hide="!sym_submit">
            <h4 class="title">Done for the day!</h4>
            <p> You have no more tasks for the day. You can review your submitted report for the day below. You can still add/edit your note for today's report.</p>
          </div>


          <div class="card padding" ng-hide="sbmtd">   
            <h4>{{text.current.reminder_title}}</h4>
                <div ng-repeat="rem in study_reminders">
                    <p>
                    <i class="ion-ios-checkmark" ng-hide="rem.reportdue" style="font-size: 120%;"></i>
                    <i class="ion-ios-circle-outline" ng-show="rem.reportdue" style="font-size: 120%;"></i>
                    {{rem.schedmsg}} <br/>
                    <div style="padding-left:18px;"> <span class="balanced" ng-bind-html="rem.reportmsg"></span> </div> 
                    <div class="divcenter" ng-show="!!rem.logmsg">
                        <a class="button button-small button-royal small-text" ui-sref="{{rem.logstate}}" ng-disabled="sbmtd || rem.disabled">
                            &nbsp&nbsp {{rem.logmsg}} &nbsp&nbsp
                        </a>
                    </div>
                    </p>
                </div>
                <div class="card padding divcenter submit-card">
                  <p ng-show="sym_scr_st">{{text.current.submit_text}}</p>
                  <p ng-show="!sym_scr_st">{{text.current.submit_cant}}</p>
                  <a class="button button-royal" ng-click="submit_for_day()" ng-disabled="sbmtd || !sym_scr_st" > &nbsp&nbsp {{text.current.submit_button}} &nbsp&nbsp </a>
                </div>
          </div>

          <!-- Card to show when the user submits the report for the day -->
          <div class="card padding" ng-show="sbmtd">
            <h4>{{text.current.report_sum_title}}</h4>
            <div ng-repeat="rem in study_reminders">
              <em class="balanced" ng-bind-html="rem.reportmsg"></em>
            </div><br/>
            <p>{{text.current.submitted_text}}</p>
          </div>

          <div class="card padding">
            <h4>Note:</h4>
              <p>
                <span ng-hide="nt_fg">{{text.current.note}}</span>
                <span ng-show="nt_fg">{{text.current.note2}}</span> <br/>
                <span ng-show="nt_fg" class="balanced">{{note}}</span>
                <div class="divcenter">
                  <a class="button button-royal" ui-sref="notes">
                    {{nt_btn_txt}}
                  </a>
                </div>
              </p>
          </div> 
        </div>
        <!-- 
        Content to display when trial is underway but past the last day.
        -->         
        <div ng-show="is_past">
            Your <em>{{title}}</em> is past. Please <b>end</b> the trial to see the results.
        </div>

    </div>

    <!-- 
    Content to display when there is no on going study
    --> 
    <div class="card padding" ng-show="!study_current">
        <h4 class="title">No ongoing trial</h4>
        <br/>
        <p>Would you like to setup a new trial?</p>
        <br/>
        <a class="button button-block button-royal" ui-sref="setup_1">
          Setup a New Trial
        </a>
    </div>   

     <div class="card padding">
        For testing purposes only: <br/>
        {{exp_id}}
     </div>

    </ion-content>  
  </ion-pane>
</ion-view>
